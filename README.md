# Анализ приложения для знакомств
## Анализ результатов AB-тестирования контрольной и тестовой групп, в которых проверялось внедрение новой рекомендательной системы для приложения знакомств

Команда разработки приложения разработала новый алгоритм для поиска наиболее подходящих анкет. Для проверки работы алгоритма был проведен AБ-тест, в котором все пользователи были разделены на 2 группы (контрольную и тестовую). Пользователи в контрольной группе (группа 0) пользовались приложением со старым алгоритмом, а пользователи тестовой группы (группа 1) - с новым.

Правда ли, что новый алгоритм улучшил качество сервиса?

Давайте узнаем!

## Предварительный анализ данных
Перед проведением анализа необходимо "предварительно" посмотреть результирующий набор данных, чтобы сформировать первое представление о том, с какими вообще данными мы имеем дело.

- Количество строк - **14514**
- Количество столбцов - **4**
- NULL-значения: **отсутствует**
- Типы данных: **Int64**
- Размер контрольной и тестовой групп: **~500 человек**
- Измеряемая метрика: **is_match (бинарная)**

## Интерпретация результатов
### Начнем интерпретацию с определения целевой метрики, которую мы проверяем

В первую очередь, для интерпретации результатов, необходимо понять, каким образом можно оценить изменение качества работы сервиса, т.е какая метрику необходимо измерить до и после введения новой рекомендательной системы

В данном случае наше нововведение - это алгоритм для поиска наиболее подходящих анкет - поиск тех анкет, которые отвечают взаимностью (взаимные лайки). Выделим для себя несколько потенциальных метрик, на которые потенциально может влиять новый алгоритм

- Общее количество взаимных лайков по продукту
- Доля взаимных лайков от общего количества лайков на 1 пользователя

## 1. Общее количество взаимных лайков по продукту 

Можно начать анализ с проверки того, как введение нового алгоритма могло повлиять на общее количество взаимных лайков по продукту. **Можно ли с помощью нового алгоритма увеличить общее количество взаимных лайков?**

Визуализация распределения общего количества лайков показала, что в группе с новым алгоритмом, количество взаимных лайков выросло в сравнении с контрольной группой, которая использует старый алгоритм. Однако, это может быть связано с тем, что у нас в целом выросло количество лайков и относительный показатель количества взаимных лайков мог остаться прежним.

<image src = "/plots/chi_square_matches" alt = "Распределение лайков для пользователей в зависимости от группы">
 
Сформируем таблицу сопряженности для 2-х категориальных переменных (group, is_match) с 2-мя градациями (0, 1) и проведем анализ с помощью X^2-критерия, убедившись перед этим, что у нас соблюдаются все условия для его проведения, и проверим гипотезу о том, что новый алгоритм увеличивает количество взаимных лайков по продукту

- Все наблюдения независимы
- Минимальное количество наблюдений в каждой ячейке больше 5

При расчете статистики X^2 получили следующие результаты 

- X^2-статистика: 618,7
- p_value: 1.44e-136

**Ожидаемая таблица сопряженности:**

|  Группа| Невзаимные лайки | Взаимные лайки |
|:----------|:----------:|:----------:|
| Контрольная    | 3193   | 1599  |
| Тестовая    | 6478  | 3244 |

**Наблюдаемая таблица сопряженности:**

|  Группа| Невзаимные лайки | Взаимные лайки |
|:----------|:----------:|:----------:|
| Контрольная    | 3858   | 934  |
| Тестовая    | 5813  | 3909  |

Видим, что наше p_value сильно меньше заявленного 0.05, из чего можем сделать вывод, что распределение по группам действительно влияет на количество лайков. Но пока что это нам не говорит о том, какие именно показатели сильно отличаются между собой. Чтобы это узнать нужно провести анализ остатков (хотя бы визуальный)

<image src = "/plots/mosaic_matches" alt = "Распределение остатков в наблюдаемом и ожидаемом распределениях">

После визуализации стало видно, что на самом деле, количество взаимных лайков в тестовой группе (с новым алгоритмом) имеет более высокое значение, нежели при распределении, в котором фактор группы никак не оказывает влияние на распределение частот лайков.

Теперь нужно проверить, насколько сильно мы можем доверять результатам статистической проверки. Для этого необходимо рассчитать размер эффекта - степень отклонения полученных наблюдений от наблюдений, в которых размер эффекта равен нулю. Это позволит нам сравнить полученный в результате внедрения нового алгоритма эффект с наименьшим истинным эффектом, который может быть обнаружен при заданных уровне значимости и размере выборки с вероятностью 80%. То есть по факту, мы проверяем насколько большая у нас вероятность совершить ошибку II рода при используемых параметрах эксперимента

**Важно понимать, что минимальный детектируемый эффект определяется перед проведением AB-тестирования, на этапе расчета длительности проведения эксперимента (длительность зависит от размера выборки, который необходимо собрать, чтобы с большой вероятностью правильно задетектировать изменения там, где они действительно присутствуют). Однако, так как мы имеем уже результаты AB-тестирования, то мы рассчитаем его уже по факту, предполагая, что именно такой MDE хотели обнаружить исследователи при определенных значениях мощности теста, уровня значимости и размера выборки.**

### 1.1 Effect Size
Рассчитаем размер эффекта для таблицы сопряженности 2 X 2. Это позволит нам понять, насколько значительная степень отклонения наблюдаемых значений от значений, размер эффекта который равняется 0. Для такой таблицы сопряженности рассчитаем Phi. Расчет проведем по формуле, взятой отсюда: # https://www.codecamp.ru/blog/effect-size-chi-square/.

**Полученный размер эффекта равен 0.79**

### 1.2 MDE
Данный размер эффекта - это значительный эффект. Можем сказать, что степень отклонения от значений, где размер эффекта равен 0, внушительная. Однако, теперь нужно сравнить стандартизированный размер эффекта, полученный в результате эксперимента с MDE для критерия X^2 с используемыми параметрами. Это позволит нам сказать, можем ли мы доверять полученным результатам проверки X^2 критерием или вероятность ошибки II рода слишком высока.

**Минимальный детектируемый эффект для данных параметров: 0.15**

Видно, что полученный размер эффекта между метриками в контрольной и тестовой группах превышает минимальный детектируемый эффект для используемых параметров. Следовательно, при интерпретации полученных результатов, можем быть уверены в их достоверности

## 2. Доля взаимных лайков от общего числа на пользователя
Теперь необходимо посмотреть, как влияет введение нового алгоритма на долю взаимных лайков от общего количества лайков на 1 пользователя.

Перед проведением сравнения 2-х средних значениях критерием Стъюдента, также, как и при расчете общего количества лайков, необходимо рассчитать минимальный детектируемый эффект - наименьший истинный эффект, который может быть определен критерием Стъюдента с определенной вероятностью при определенном уровне значимости. В нашем случае у нас есть следующие параметры:

- Уровень значимости
- Мощность теста
- Размер выборки







